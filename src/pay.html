<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>聚合收款</title>
    <script type="text/javascript" src="https://lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://lib.baomitu.com/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>
    <link href="./css/style.css" rel="stylesheet">
    <link rel="shortcut icon" href="./img/X.png" type="image/x-icon" />
</head>
<body id="color">
<div class="container" id="code-all">
    <div id="ui-head">
        <img class="head" src="./img/x.png">
        <p class="pay_way">支付平台</p>
    </div>
    <div class="ui-box">
        <p class="pay_tips">扫一扫向x付款</p>
        <img id="page-url">
    </div>
</div>
<script type="text/javascript" src="./js/pay.js"></script>
<script src="js/index.js"></script>
<script>
    let setting = {
        nick: GetQueryString('nick'),
        qqUrl: GetQueryString('qq'),
        wechatUrl: GetQueryString('vx'),
        aliUrl: GetQueryString('ali'),
    }
    console.log(setting)

    function convertCanvasToImage() {
        let canvas = document.getElementsByTagName('canvas')[0];
        let image = new Image();
        data = canvas.toDataURL("image/jpeg");
        return data;
    }

    if (navigator.userAgent.match(/Alipay/i)) {
        window.location.href = setting.aliUrl;
    } else if (navigator.userAgent.match(/MicroMessenger\//i)) {
        $('.pay_tips').html("长按识别向" + setting.nick + "付款");
        $('.pay_tips').css("color", "#ffffff");
        $('.pay_way').html("微信支付");
        $('.head').attr("src", './img/wx.png');
        $('.ui-box').css("background-color", "#54bc6e");
        $("#page-url").qrcode({
            colorDark: "#000000",
            colorLight: "#ffffff",
            text: setting.wechatUrl,
        });
        document.getElementById("page-url").src = convertCanvasToImage();
    } else if (navigator.userAgent.match(/QQ\//i)) {
        $('.pay_tips').html("长按识别向" + setting.nick + "付款");
        $('.pay_tips').css("color", "#ffffff");
        $('.pay_way').html("QQ钱包");
        $('.head').attr("src", './img/QQ.png');
        $('.ui-box').css("background-color", "#049fda");
        $("#page-url").qrcode({
            colorDark: "#000000",
            colorLight: "#ffffff",
            text: setting.qqUrl,
        });
        document.getElementById("page-url").src = convertCanvasToImage();
    } else {
        $('.pay_tips').html("扫一扫向" + setting.nick + "付款");
        $("#page-url").qrcode({
            colorDark: "#000000",
            colorLight: "#ffffff",
            text: window.location.href,
        });
        document.getElementById("page-url").src = convertCanvasToImage();
    }

</script>
</body>
</html>
